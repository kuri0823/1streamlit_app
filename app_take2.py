import streamlit as st
import pandas as pd
from pathlib import Path

# =========================
# ãƒšãƒ¼ã‚¸è¨­å®š
# =========================
st.set_page_config(
    page_title="å›³æ›¸é¤¨çµ±è¨ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰",
    layout="wide"
)

st.title("ğŸ“š æ—¥æœ¬ã®å›³æ›¸é¤¨çµ±è¨ˆãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–ã‚¢ãƒ—ãƒª")
st.markdown("e-Statï¼ˆæ”¿åºœçµ±è¨ˆï¼‰ã‚’ã‚‚ã¨ã«ã€è¨­ç½®è€…åˆ¥ã®å›³æ›¸é¤¨æ•°ã‚’å¯è¦–åŒ–ã™ã‚‹ã€‚")

# =========================
# CSV èª­ã¿è¾¼ã¿ï¼ˆCloudå¯¾å¿œï¼‰
# =========================
BASE_DIR = Path(__file__).parent
csv_path = BASE_DIR / "data.csv"

df = pd.read_csv(csv_path)

# =========================
# å‰å‡¦ç†
# =========================
# æ•°å€¤åˆ—ã®ã‚«ãƒ³ãƒå‰Šé™¤
for col in df.columns:
    df[col] = df[col].astype(str).str.replace(",", "", regex=False)

numeric_cols = df.columns[3:]
for col in numeric_cols:
    df[col] = pd.to_numeric(df[col], errors="coerce")

# =========================
# ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼ˆæ“ä½œUIï¼‰
# =========================
with st.sidebar:
    st.header("ğŸ”§ è¡¨ç¤ºæ¡ä»¶")
    target_col = st.selectbox(
        "è¡¨ç¤ºã™ã‚‹åŒºåˆ†ã‚’é¸æŠ",
        ["éƒ½é“åºœçœŒ", "å¸‚ï¼ˆåŒºï¼‰", "ç”º", "æ‘"]
    )

# =========================
# ã‚¿ãƒ–æ§‹æˆï¼ˆæœªä½¿ç”¨UIéƒ¨å“ï¼‰
# =========================
tab1, tab2, tab3 = st.tabs(["ğŸ“Š æ¦‚è¦", "ğŸ“ˆ å¯è¦–åŒ–", "ğŸ“ è€ƒå¯Ÿ"])

# =========================
# ã‚¿ãƒ–1ï¼šæ¦‚è¦
# =========================
with tab1:
    st.subheader("ãƒ‡ãƒ¼ã‚¿æ¦‚è¦")
    st.dataframe(df)

    total = int(df.loc[0, "è¨ˆ"])
    st.metric(label="å…¨å›½ã®å›³æ›¸é¤¨æ•°ï¼ˆè¨ˆï¼‰", value=total)

    with st.expander("ãƒ‡ãƒ¼ã‚¿ã«ã¤ã„ã¦"):
        st.write("""
        æœ¬ãƒ‡ãƒ¼ã‚¿ã¯ e-Stat ã«æ²è¼‰ã•ã‚Œã¦ã„ã‚‹æ—¥æœ¬ã®å›³æ›¸é¤¨çµ±è¨ˆã‚’åŠ å·¥ã—ãŸã‚‚ã®ã§ã‚ã‚‹ã€‚
        æœ¬é¤¨ãƒ»åˆ†é¤¨åˆ¥ã€è”µæ›¸å†Šæ•°åˆ¥ã€è¨­ç½®è€…åˆ¥ã®é›†è¨ˆçµæœã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã€‚
        """)

# =========================
# ã‚¿ãƒ–2ï¼šå¯è¦–åŒ–
# =========================
with tab2:
    st.subheader(f"{target_col}åˆ¥ å›³æ›¸é¤¨æ•°")

    chart_data = df.loc[0, ["è¨ˆ", target_col]]
    st.bar_chart(chart_data)

    st.subheader("åŒºåˆ†åˆ¥æ¯”è¼ƒï¼ˆæŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ï¼‰")
    line_data = df[target_col]
    st.line_chart(line_data)

# =========================
# ã‚¿ãƒ–3ï¼šè€ƒå¯Ÿ
# =========================
with tab3:
    st.write("""
    æœ¬ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã€å¸‚ï¼ˆåŒºï¼‰ã«è¨­ç½®ã•ã‚Œã¦ã„ã‚‹å›³æ›¸é¤¨ãŒæœ€ã‚‚å¤šãã€
    æ‘ã‚„ç”ºã§ã¯è¨­ç½®æ•°ãŒå°‘ãªã„å‚¾å‘ãŒç¢ºèªã§ãã‚‹ã€‚
    ã“ã‚Œã¯äººå£åˆ†å¸ƒã‚„è‡ªæ²»ä½“è¦æ¨¡ã®é•ã„ãŒå½±éŸ¿ã—ã¦ã„ã‚‹ã¨è€ƒãˆã‚‰ã‚Œã‚‹ã€‚
    """)

st.caption("ãƒ‡ãƒ¼ã‚¿å‡ºå…¸ï¼še-Statï¼ˆæ”¿åºœçµ±è¨ˆï¼‰")
